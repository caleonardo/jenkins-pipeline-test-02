pipeline {
  agent {
      label "gce-agent"
  }
  stages {
    stage('TF init') {
      steps {
          sh '''
          .tf-wrapper2.sh init $BRANCH_NAME
          '''
      }
    }
    stage('TF plan') {
      steps {
          sh '''
          cd build
          ./tf-wrapper2.sh plan $BRANCH_NAME
          '''
        }
    }
    stage('TF validate') {
      steps {
          sh '''
          cd build
          ./tf-wrapper2.sh validate $BRANCH_NAME $POLICY_REPO
          '''
        }
    }
    stage('TF apply') {
      steps {
          sh '''
          cd build
          ./tf-wrapper2.sh apply $BRANCH_NAME
          '''
        }
    }
  }
}
